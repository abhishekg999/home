---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { TableOfContents } from "../../components/TableOfContents";
import RelatedPosts from "../../components/RelatedPosts.astro";
import { formatDate, getReadingTime } from "../../utils/blog";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content, headings } = await post.render();
const stats = { text: getReadingTime(post.body) };
---

<BaseLayout
  title={post.data.title}
  description={post.data.description || post.data.title}
>
  <main class="flex-grow relative z-20 pt-24 pb-16 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto flex gap-6">
      <article
        class="flex-1 min-w-0 bg-gray-900/70 backdrop-blur-md rounded p-5 md:p-8 lg:p-10 shadow-2xl overflow-hidden border-2 border-gray-700/50"
      >
        <header class="mb-8 md:mb-10 pb-6 border-b border-gray-800">
          <a
            href="/blog"
            class="text-green-500/80 hover:text-green-500 mb-6 inline-flex items-center gap-2 text-sm font-medium transition-colors"
          >
            ← Back to Posts
          </a>
          <h1
            class="text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-4 leading-tight"
          >
            {post.data.title}
          </h1>
          <div class="flex items-center gap-4 text-sm text-gray-400">
            <time class="font-medium">
              {formatDate(post.data.date)}
            </time>
            <span class="text-gray-600">•</span>
            <span class="flex items-center gap-1">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              {stats.text}
            </span>
          </div>
          {
            post.data.tags && post.data.tags.length > 0 && (
              <div class="flex gap-2 mt-4 flex-wrap">
                {post.data.tags.map((tag) => (
                  <span class="px-2.5 py-1 md:px-3 bg-gray-800/60 text-green-500/80 rounded text-xs font-medium border border-gray-700/60">
                    {tag}
                  </span>
                ))}
              </div>
            )
          }
        </header>

        <div
          class="prose prose-invert prose-lg max-w-none overflow-x-hidden
        prose-headings:text-white prose-headings:font-bold prose-headings:mb-4 prose-headings:mt-8 prose-headings:break-words
        prose-h1:text-3xl prose-h2:text-2xl prose-h3:text-xl
        prose-p:text-gray-200 prose-p:leading-relaxed prose-p:mb-4 prose-p:break-words
        prose-a:text-green-500/80 prose-a:no-underline prose-a:font-medium hover:prose-a:text-green-500 prose-a:transition-colors prose-a:break-words
        prose-strong:text-white prose-strong:font-semibold
        prose-code:text-green-500/80 prose-code:text-sm prose-code:font-mono prose-code:break-words prose-code:break-all
            prose-img:rounded prose-img:shadow-lg prose-img:my-8 prose-img:max-w-full prose-img:h-auto
        prose-pre:max-w-full prose-pre:overflow-x-auto
        prose-blockquote:border-l-4 prose-blockquote:border-green-400 prose-blockquote:bg-gray-800/50 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:rounded-r
        prose-blockquote:text-gray-300 prose-blockquote:italic prose-blockquote:break-words
        prose-ul:text-gray-200 prose-ul:break-words prose-ol:text-gray-200 prose-ol:break-words
        prose-li:marker:text-green-500/80 prose-li:break-words
        prose-table:border prose-table:border-gray-700 prose-table:w-full prose-table:overflow-x-auto prose-table:block
        prose-th:bg-gray-800/80 prose-th:text-white prose-th:font-semibold prose-th:break-words
        prose-td:border prose-td:border-gray-700 prose-td:text-gray-200 prose-td:break-words
        prose-hr:border-gray-700"
        >
          <Content />
        </div>
        <RelatedPosts currentPost={post} />
      </article>
      <aside class="hidden xl:block w-52 shrink-0">
        <TableOfContents headings={headings} client:load />
      </aside>
    </div>
  </main>
</BaseLayout>
