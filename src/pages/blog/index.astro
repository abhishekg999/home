---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { formatDate, getReadingTime } from "../../utils/blog";
import {
  generateWebPageSchema,
  getCanonicalUrl,
  getOgImageUrl,
} from "../../utils/seo";

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);

const postsWithReadingTime = await Promise.all(
  posts.map(async (post) => {
    const { remarkPluginFrontmatter } = await post.render();
    return {
      ...post,
      readingTime: getReadingTime(post.body),
    };
  }),
);

const canonicalUrl = getCanonicalUrl("/blog");
const ogImageUrl = getOgImageUrl("blog");
const description =
  "Technical writeups about engineering, web exploitation, CTF challenges, and security research.";
const schema = generateWebPageSchema(
  "Abhishek Govindarasu - Blog",
  description,
  canonicalUrl,
);
---

<BaseLayout
  title="Abhishek Govindarasu - Blog"
  description={description}
  canonical={canonicalUrl}
  ogImage={ogImageUrl}
  schema={schema}
>
  <main class="flex-grow relative z-20">
    <section class="pt-24 pb-12 lg:pt-40 lg:pb-24 px-4 lg:px-8">
      <div class="max-w-7xl mx-auto">
        <div class="max-w-3xl mb-12 lg:mb-24">
          <h1
            class="text-3xl lg:text-7xl font-bold tracking-tight text-balance mb-3 lg:mb-6"
          >
            Technical Writings
          </h1>
          <p class="text-sm lg:text-xl text-gray-400 leading-relaxed">
            Technical writeups about engineering, web exploitation, CTF
            challenges, and security research.
          </p>
        </div>

        <div class="space-y-0">
          {
            postsWithReadingTime.map((post, index) => {
              const year = post.data.date.getFullYear().toString();
              return (
                <a href={`/blog/${post.slug}`} class="group block relative">
                  <div class="border-t border-white/10 py-6 lg:py-12 transition-all duration-300 hover:bg-white/[0.02]">
                    <div class="flex items-start lg:items-center gap-4 lg:gap-12">
                      <div class="w-14 h-14 lg:w-24 lg:h-24 flex items-center justify-center flex-shrink-0 bg-white/5 border border-white/10 group-hover:bg-white/10 group-hover:border-[#67d78e]/30 transition-all duration-300">
                        <span class="text-base lg:text-2xl font-semibold text-white/90 font-mono">
                          '{year.slice(-2)}
                        </span>
                      </div>

                      <div class="flex-grow min-w-0 pr-4 lg:pr-8">
                        <div class="flex items-baseline gap-4 mb-2 lg:mb-3">
                          <h2 class="text-lg lg:text-4xl font-semibold text-white group-hover:text-[#67d78e] transition-colors">
                            {post.data.title}
                          </h2>
                        </div>

                        {post.data.tags && post.data.tags.length > 0 && (
                          <div class="flex flex-wrap gap-2 mb-2 lg:mb-3">
                            {post.data.tags.slice(0, 3).map((tag) => (
                              <span class="inline-flex items-center px-2 py-0.5 lg:px-2.5 lg:py-1 rounded text-xs font-medium bg-[#67d78e]/10 text-[#67d78e]/90 border border-[#67d78e]/20 group-hover:bg-[#67d78e]/20 group-hover:border-[#67d78e]/40 transition-all">
                                {tag}
                              </span>
                            ))}
                          </div>
                        )}

                        <div class="flex items-center gap-3 lg:gap-6 text-xs lg:text-sm font-mono text-white/40 group-hover:text-white/60 transition-colors">
                          <div class="flex items-center gap-1.5 lg:gap-2">
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              class="h-3 w-3 lg:h-4 lg:w-4"
                              fill="none"
                              viewBox="0 0 24 24"
                              stroke="currentColor"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                              />
                            </svg>
                            <span>{formatDate(post.data.date)}</span>
                          </div>
                          {post.readingTime && (
                            <div class="flex items-center gap-1.5 lg:gap-2">
                              <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-3 w-3 lg:h-4 lg:w-4"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                                stroke-width="2"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                />
                              </svg>
                              <span>{post.readingTime}</span>
                            </div>
                          )}
                        </div>
                      </div>

                      <div class="hidden lg:flex items-center gap-4 flex-shrink-0">
                        <span class="text-sm font-mono text-white/30 group-hover:text-white/50 transition-colors">
                          {String(index + 1).padStart(2, "0")}
                        </span>
                        <svg
                          class="w-4 h-4 text-white/30 group-hover:text-white/60 group-hover:translate-x-1 transition-all"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="square"
                            stroke-linejoin="miter"
                            stroke-width={2}
                            d="M17 8l4 4m0 0l-4 4m4-4H3"
                          />
                        </svg>
                      </div>
                    </div>

                    <div class="absolute left-0 top-0 w-1 h-0 group-hover:h-full transition-all duration-300 bg-[#67d78e]" />
                  </div>
                </a>
              );
            })
          }
          <div class="border-t border-white/10"></div>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>
