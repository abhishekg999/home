---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { formatDate, getReadingTime } from "../../utils/blog";
import {
  generateWebPageSchema,
  getCanonicalUrl,
  getOgImageUrl,
} from "../../utils/seo";

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);

const postsWithReadingTime = await Promise.all(
  posts.map(async (post) => {
    const { remarkPluginFrontmatter } = await post.render();
    return {
      ...post,
      readingTime: getReadingTime(post.body),
    };
  }),
);

const canonicalUrl = getCanonicalUrl("/blog");
const ogImageUrl = getOgImageUrl("blog");
const description =
  "Technical writeups about engineering, web exploitation, CTF challenges, and security research.";
const schema = generateWebPageSchema(
  "Abhishek Govindarasu - Blog",
  description,
  canonicalUrl,
);
---

<BaseLayout
  title="Abhishek Govindarasu - Blog"
  description={description}
  canonical={canonicalUrl}
  ogImage={ogImageUrl}
  schema={schema}
>
  <main class="flex-grow relative z-20">
    <section class="pt-28 pb-16 lg:pt-44 lg:pb-28 px-4 lg:px-8">
      <div class="max-w-5xl mx-auto">
        <div class="max-w-2xl mb-12 lg:mb-20">
          <h1 class="text-3xl lg:text-5xl font-bold tracking-tight mb-4">
            Writings
          </h1>
          <p class="text-sm lg:text-base text-white/50 leading-relaxed">
            Technical writeups on engineering, web exploitation, and security
            research.
          </p>
        </div>

        <div class="space-y-0">
          {
            postsWithReadingTime.map((post, index) => {
              const year = post.data.date.getFullYear().toString();
              return (
                <a href={`/blog/${post.slug}`} class="group block relative">
                  <div class="border-t border-white/10 py-6 lg:py-10 transition-all duration-300 hover:bg-white/[0.02]">
                    <div class="flex items-start lg:items-center gap-4 lg:gap-8">
                      <div class="w-12 h-12 lg:w-16 lg:h-16 flex items-center justify-center flex-shrink-0 bg-white/5 border border-white/10 group-hover:bg-white/8 group-hover:border-accent/30 transition-all duration-300">
                        <span class="text-sm lg:text-lg font-medium text-white/70 font-mono">
                          '{year.slice(-2)}
                        </span>
                      </div>

                      <div class="flex-grow min-w-0 pr-4 lg:pr-8">
                        <div class="flex items-baseline gap-4 mb-2">
                          <h2 class="text-base lg:text-xl font-semibold text-white group-hover:text-accent transition-colors">
                            {post.data.title}
                          </h2>
                        </div>

                        {post.data.tags && post.data.tags.length > 0 && (
                          <div class="flex flex-wrap gap-1.5 mb-2">
                            {post.data.tags.slice(0, 3).map((tag) => (
                              <span class="inline-flex items-center px-1.5 py-0.5 text-[10px] font-medium text-white/40 border border-white/10 group-hover:text-white/60 group-hover:border-white/20 transition-all">
                                {tag}
                              </span>
                            ))}
                          </div>
                        )}

                        <div class="flex items-center gap-4 text-xs font-mono text-white/30 group-hover:text-white/50 transition-colors">
                          <span>{formatDate(post.data.date)}</span>
                          {post.readingTime && <span>{post.readingTime}</span>}
                        </div>
                      </div>

                      <div class="hidden lg:flex items-center gap-3 flex-shrink-0">
                        <span class="text-xs font-mono text-white/20 group-hover:text-white/40 transition-colors">
                          {String(index + 1).padStart(2, "0")}
                        </span>
                        <svg
                          class="w-3.5 h-3.5 text-white/20 group-hover:text-white/50 group-hover:translate-x-1 transition-all"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="square"
                            stroke-linejoin="miter"
                            stroke-width={2}
                            d="M17 8l4 4m0 0l-4 4m4-4H3"
                          />
                        </svg>
                      </div>
                    </div>

                    <div class="absolute left-0 top-0 w-1 h-0 group-hover:h-full transition-all duration-300 bg-accent" />
                  </div>
                </a>
              );
            })
          }
          <div class="border-t border-white/10"></div>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>
